<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Position Vector, Unit Vector & Force Practice</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Segoe UI',sans-serif;background:#f0f4f8;color:#222;min-height:100vh}
header{background:#1a3a5c;color:#fff;padding:16px 28px}
header h1{font-size:1.15rem;font-weight:700}
header p{font-size:.8rem;opacity:.75;margin-top:2px}
.container{max-width:960px;margin:24px auto;padding:0 14px;display:grid;grid-template-columns:1fr 1fr;gap:18px}
.full{grid-column:1/-1}
.card{background:#fff;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,.08);padding:20px 22px}
.card h2{font-size:.95rem;font-weight:700;color:#1a3a5c;margin-bottom:12px;display:flex;align-items:center;gap:7px}
.points-row{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:10px}
.point-box{flex:1;min-width:130px;border-radius:8px;padding:12px 16px;text-align:center}
.point-box.pt-a{background:#e8f4fd;border:2px solid #2980b9}
.point-box.pt-b{background:#fef9e7;border:2px solid #f39c12}
.point-box .pt-label{font-size:.75rem;font-weight:700;letter-spacing:.5px;text-transform:uppercase;opacity:.7;margin-bottom:4px}
.point-box .pt-coords{font-size:1.1rem;font-weight:700;font-family:monospace}
.point-box.pt-a .pt-coords{color:#1a6eb5}
.point-box.pt-b .pt-coords{color:#d68910}
#canvas3d{width:100%;height:280px;border-radius:8px;background:#f8fafc;cursor:grab;display:block;border:1px solid #dde}
#canvas3d:active{cursor:grabbing}
.step{border-left:3px solid #1a3a5c;padding:10px 14px;margin-bottom:12px;background:#f7f9fc;border-radius:0 7px 7px 0}
.step-num{font-size:.72rem;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:#1a3a5c;margin-bottom:5px}
.step-title{font-size:.92rem;font-weight:700;color:#222;margin-bottom:6px}
.step-desc{font-size:.84rem;color:#555;line-height:1.55;margin-bottom:10px}
.formula-box{background:#1a3a5c;color:#fff;border-radius:6px;padding:9px 14px;font-family:monospace;font-size:.88rem;margin-bottom:10px;line-height:1.6}
.formula-box .hl{color:#f1c40f}
.input-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px}
.inp-wrap{display:flex;flex-direction:column;gap:3px}
.inp-wrap label{font-size:.75rem;font-weight:700;color:#555;text-align:center}
.inp-wrap input{width:100%;padding:8px 6px;border:2px solid #b0bec5;border-radius:6px;font-size:.9rem;text-align:center;font-family:monospace;transition:border-color .2s}
.inp-wrap input:focus{outline:none;border-color:#1a3a5c}
.inp-wrap input.correct{border-color:#27ae60;background:#eafaf1}
.inp-wrap input.wrong{border-color:#e74c3c;background:#fdecea}
.inp-hint{font-size:.75rem;text-align:center;min-height:15px;margin-top:1px;font-weight:700}
.inp-hint.ok{color:#27ae60}
.inp-hint.err{color:#e74c3c}
.check-banner{border-radius:7px;padding:10px 14px;font-size:.88rem;margin-top:10px;display:none}
.check-banner.ok{background:#eafaf1;border:1px solid #a9dfbf;color:#1e8449;display:block}
.check-banner.err{background:#fdecea;border:1px solid #f5b7b1;color:#c0392b;display:block}
.check-banner.info{background:#eaf4fb;border:1px solid #aed6f1;color:#1a5276;display:block}
.btn{border:none;border-radius:6px;padding:9px 18px;font-size:.84rem;font-weight:700;cursor:pointer;transition:all .15s}
.btn-p{background:#1a3a5c;color:#fff}.btn-p:hover{background:#14304d}
.btn-s{background:#e8eef4;color:#1a3a5c}.btn-s:hover{background:#d2dce8}
.btn-g{background:#27ae60;color:#fff}.btn-g:hover{background:#1e8449}
.btn-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
.mode-row{display:flex;gap:6px;margin-bottom:14px;flex-wrap:wrap}
.mode-btn{border:2px solid #b0bec5;background:#fff;border-radius:7px;padding:7px 14px;font-size:.82rem;font-weight:600;cursor:pointer;color:#555;transition:all .15s}
.mode-btn.active{border-color:#1a3a5c;background:#1a3a5c;color:#fff}
.hint-text{font-size:.78rem;color:#555;margin-top:8px;line-height:1.6;display:none;background:#fffde7;border:1px solid #ffe082;border-radius:6px;padding:10px 14px}
.hint-text.show{display:block}
.progress-row{display:flex;align-items:center;gap:10px;margin-bottom:4px}
.prog-bar{flex:1;height:8px;background:#e0e6ed;border-radius:4px;overflow:hidden}
.prog-fill{height:100%;background:#27ae60;border-radius:4px;transition:width .4s}
.prog-label{font-size:.8rem;color:#555;min-width:50px;text-align:right}
.score-summary{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
.score-item{flex:1;min-width:80px;background:#f0f4f8;border-radius:7px;padding:10px;text-align:center}
.score-item .s-val{font-size:1.4rem;font-weight:800;color:#1a3a5c}
.score-item .s-lbl{font-size:.72rem;color:#777;margin-top:2px}
@media(max-width:640px){.container{grid-template-columns:1fr}.full{grid-column:1}}
</style>
</head>
<body>
<header>
  <h1>ğŸ“ Position Vector, Unit Vector & Force Practice</h1>
  <p>Randomly generated 3D points â€” practice writing position vectors, computing unit vectors, and expressing forces in Cartesian form</p>
</header>
<div class="container">

  <!-- Points & canvas -->
  <div class="card full">
    <h2>ğŸ¯ Given Points</h2>
    <div class="mode-row">
      <button class="mode-btn active" id="mAB" onclick="setMode('AB')">From A to B</button>
      <button class="mode-btn" id="mBA" onclick="setMode('BA')">From B to A</button>
    </div>
    <div class="points-row" id="points-display"></div>
    <canvas id="canvas3d"></canvas>
    <div class="btn-row">
      <button class="btn btn-g" onclick="newProblem()">ğŸ² New Problem</button>
      <button class="btn btn-s" onclick="toggleHints()">ğŸ’¡ Formula Hints</button>
    </div>
    <div class="hint-text" id="global-hint">
      <strong>Position Vector r<sub>AB</sub></strong> = (x<sub>B</sub>âˆ’x<sub>A</sub>)Ã® + (y<sub>B</sub>âˆ’y<sub>A</sub>)Äµ + (z<sub>B</sub>âˆ’z<sub>A</sub>)kÌ‚<br/>
      <strong>Magnitude |r|</strong> = âˆš(rxÂ² + ryÂ² + rzÂ²)<br/>
      <strong>Unit Vector Ã»</strong> = r / |r| = (rx/|r|)Ã® + (ry/|r|)Äµ + (rz/|r|)kÌ‚<br/>
      <strong>Force Vector F</strong> = F Â· Ã» = (FÂ·Ã»x)Ã® + (FÂ·Ã»y)Äµ + (FÂ·Ã»z)kÌ‚<br/>
      Note: |Ã»| = 1 always.
    </div>
  </div>

  <!-- Step 1 -->
  <div class="card">
    <h2>â¡ï¸ Step 1: Position Vector</h2>
    <div class="step">
      <div class="step-num">Concept</div>
      <div class="step-title" id="s1-title">Position Vector r<sub>AB</sub></div>
      <div class="step-desc">Subtract tail coordinates from tip coordinates component by component:</div>
      <div class="formula-box">r = (<span class="hl">x_tip âˆ’ x_tail</span>)Ã® + (<span class="hl">y_tip âˆ’ y_tail</span>)Äµ + (<span class="hl">z_tip âˆ’ z_tail</span>)kÌ‚</div>
    </div>
    <p style="font-size:.85rem;color:#555;margin-bottom:6px">Enter each component:</p>
    <div class="input-grid">
      <div class="inp-wrap">
        <label>x-component</label>
        <input type="number" step="any" id="rx" placeholder="?" oninput="liveCheck('rx')"/>
        <div class="inp-hint" id="hrx"></div>
      </div>
      <div class="inp-wrap">
        <label>y-component</label>
        <input type="number" step="any" id="ry" placeholder="?" oninput="liveCheck('ry')"/>
        <div class="inp-hint" id="hry"></div>
      </div>
      <div class="inp-wrap">
        <label>z-component</label>
        <input type="number" step="any" id="rz" placeholder="?" oninput="liveCheck('rz')"/>
        <div class="inp-hint" id="hrz"></div>
      </div>
    </div>
    <div id="b1" class="check-banner"></div>
  </div>

  <!-- Step 2 -->
  <div class="card">
    <h2>ğŸ“ Step 2: Magnitude</h2>
    <div class="step">
      <div class="step-num">Concept</div>
      <div class="step-title">Magnitude |r|</div>
      <div class="step-desc">Apply the 3D Pythagorean theorem:</div>
      <div class="formula-box">|r| = âˆš( rxÂ² + ryÂ² + rzÂ² )</div>
    </div>
    <p style="font-size:.85rem;color:#555;margin-bottom:6px">Enter the magnitude (round to 3 decimal places):</p>
    <div class="input-grid" style="max-width:180px">
      <div class="inp-wrap">
        <label>|r| (units)</label>
        <input type="number" step="any" id="mag" placeholder="?" oninput="liveCheck('mag')"/>
        <div class="inp-hint" id="hmag"></div>
      </div>
    </div>
    <div id="b2" class="check-banner"></div>
  </div>

  <!-- Step 3 -->
  <div class="card full">
    <h2>ğŸ§­ Step 3: Unit Vector</h2>
    <div class="step">
      <div class="step-num">Concept</div>
      <div class="step-title" id="s3-title">Unit Vector Ã»<sub>AB</sub></div>
      <div class="step-desc">Divide each position vector component by the magnitude. Each component is between âˆ’1 and +1, and the sum of squares = 1.</div>
      <div class="formula-box">Ã» = (rx/|r|)Ã® + (ry/|r|)Äµ + (rz/|r|)kÌ‚ &nbsp;â†’&nbsp; <span class="hl">|Ã»| must = 1</span></div>
    </div>
    <p style="font-size:.85rem;color:#555;margin-bottom:6px">Enter each component (round to 4 decimal places):</p>
    <div class="input-grid" style="max-width:420px">
      <div class="inp-wrap">
        <label>Ã® component</label>
        <input type="number" step="any" id="ux" placeholder="?" oninput="liveCheck('ux')"/>
        <div class="inp-hint" id="hux"></div>
      </div>
      <div class="inp-wrap">
        <label>Äµ component</label>
        <input type="number" step="any" id="uy" placeholder="?" oninput="liveCheck('uy')"/>
        <div class="inp-hint" id="huy"></div>
      </div>
      <div class="inp-wrap">
        <label>kÌ‚ component</label>
        <input type="number" step="any" id="uz" placeholder="?" oninput="liveCheck('uz')"/>
        <div class="inp-hint" id="huz"></div>
      </div>
    </div>
    <div id="b3" class="check-banner"></div>
  </div>

  <!-- Step 4 -->
  <div class="card full">
    <h2>âš¡ Step 4: Force Vector in Cartesian Form</h2>
    <div class="step">
      <div class="step-num">Concept</div>
      <div class="step-title">F = F Â· Ã»</div>
      <div class="step-desc">A force of magnitude <strong id="force-mag-display">â€”</strong> N acts along the line from tail to tip. Scale the unit vector by the magnitude:</div>
      <div class="formula-box"><span class="hl">F</span> = F Â· Ã» = (FÂ·Ã»x)Ã® + (FÂ·Ã»y)Äµ + (FÂ·Ã»z)kÌ‚</div>
    </div>
    <p style="font-size:.85rem;color:#555;margin-bottom:6px">Enter each force component (round to 2 decimal places):</p>
    <div class="input-grid" style="max-width:420px">
      <div class="inp-wrap">
        <label>Fx (N)</label>
        <input type="number" step="any" id="fx" placeholder="?" oninput="liveCheck('fx')"/>
        <div class="inp-hint" id="hfx"></div>
      </div>
      <div class="inp-wrap">
        <label>Fy (N)</label>
        <input type="number" step="any" id="fy" placeholder="?" oninput="liveCheck('fy')"/>
        <div class="inp-hint" id="hfy"></div>
      </div>
      <div class="inp-wrap">
        <label>Fz (N)</label>
        <input type="number" step="any" id="fz" placeholder="?" oninput="liveCheck('fz')"/>
        <div class="inp-hint" id="hfz"></div>
      </div>
    </div>
    <div id="b4" class="check-banner"></div>
    <div class="btn-row">
      <button class="btn btn-p" onclick="checkAll()">âœ” Check All Steps</button>
      <button class="btn btn-s" onclick="revealAnswer()">ğŸ‘ Reveal Answer</button>
      <button class="btn btn-g" onclick="newProblem()">ğŸ² New Problem</button>
    </div>
  </div>

  <!-- Score -->
  <div class="card full">
    <h2>ğŸ† Your Progress</h2>
    <div class="progress-row">
      <div class="prog-bar"><div class="prog-fill" id="prog-fill" style="width:0%"></div></div>
      <div class="prog-label" id="prog-label">0 / 0</div>
    </div>
    <div class="score-summary">
      <div class="score-item"><div class="s-val" id="sc-att">0</div><div class="s-lbl">Attempted</div></div>
      <div class="score-item"><div class="s-val" id="sc-cor">0</div><div class="s-lbl">Fully Correct</div></div>
      <div class="score-item"><div class="s-val" id="sc-str">â€”</div><div class="s-lbl">Streak ğŸ”¥</div></div>
      <div class="score-item"><div class="s-val" id="sc-pct">â€”</div><div class="s-lbl">Accuracy</div></div>
    </div>
  </div>

</div>

<script>
// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let A={x:0,y:0,z:0}, B={x:0,y:0,z:0};
let forceMag=0;
// ans keys match input ids exactly: rx,ry,rz,mag,ux,uy,uz,fx,fy,fz
let ans={rx:0,ry:0,rz:0,mag:0,ux:0,uy:0,uz:0,fx:0,fy:0,fz:0};
let mode='AB';
let scoreAtt=0,scoreCor=0,streak=0,lastChecked=false,hintsVisible=false;
let rotX=0.25,rotY=0.55,dragging=false,lastMX=0,lastMY=0;

// â”€â”€ Tolerances keyed by input id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const TOL={rx:.05,ry:.05,rz:.05,mag:.001,ux:.001,uy:.001,uz:.001,fx:.05,fy:.05,fz:.05};

// â”€â”€ Generate problem â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function rand(a,b){let v;do{v=Math.floor(Math.random()*(b-a+1))+a;}while(v===0);return v;}

function newProblem(){
  A={x:rand(-8,8),y:rand(-8,8),z:rand(-8,8)};
  do{B={x:rand(-8,8),y:rand(-8,8),z:rand(-8,8)};}
  while(B.x===A.x&&B.y===A.y&&B.z===A.z);
  forceMag=Math.floor(rand(4,39))*25;
  document.getElementById('force-mag-display').textContent=forceMag;
  computeAnswers();
  renderPoints();
  clearInputs();
  drawScene();
  lastChecked=false;
}

function computeAnswers(){
  const tail=mode==='BA'?B:A, tip=mode==='BA'?A:B;
  const rx=tip.x-tail.x, ry=tip.y-tail.y, rz=tip.z-tail.z;
  const mag=Math.sqrt(rx*rx+ry*ry+rz*rz);
  ans={rx,ry,rz,mag,
       ux:rx/mag,uy:ry/mag,uz:rz/mag,
       fx:forceMag*(rx/mag),fy:forceMag*(ry/mag),fz:forceMag*(rz/mag)};
}

function renderPoints(){
  const tail=mode==='BA'?B:A, tip=mode==='BA'?A:B;
  const tLbl=mode==='BA'?'B (Tail)':'A (Tail)', hLbl=mode==='BA'?'A (Tip)':'B (Tip)';
  document.getElementById('points-display').innerHTML=`
    <div class="point-box pt-a">
      <div class="pt-label">${tLbl} â€” Origin</div>
      <div class="pt-coords">(${tail.x}, ${tail.y}, ${tail.z})</div>
    </div>
    <div style="display:flex;align-items:center;font-size:1.5rem;color:#999">â†’</div>
    <div class="point-box pt-b">
      <div class="pt-label">${hLbl} â€” Head</div>
      <div class="pt-coords">(${tip.x}, ${tip.y}, ${tip.z})</div>
    </div>`;
  const sub=mode==='BA'?'BA':'AB';
  document.getElementById('s1-title').innerHTML=`Position Vector r<sub>${sub}</sub>`;
  document.getElementById('s3-title').innerHTML=`Unit Vector Ã»<sub>${sub}</sub>`;
}

// â”€â”€ Live checking â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function liveCheck(id){
  const inp=document.getElementById(id);
  const hint=document.getElementById('h'+id);
  const v=parseFloat(inp.value);
  if(isNaN(v)||inp.value.trim()===''){
    inp.className=''; hint.textContent=''; hint.className='inp-hint'; return;
  }
  const ok=Math.abs(v-ans[id])<=TOL[id];
  inp.className=ok?'correct':'wrong';
  hint.textContent=ok?'âœ“':'âœ—';
  hint.className='inp-hint '+(ok?'ok':'err');
}

// â”€â”€ Check all â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function stepOk(ids, tols){
  return ids.every(id=>{
    const v=parseFloat(document.getElementById(id).value);
    return !isNaN(v) && Math.abs(v-ans[id])<=(tols||TOL)[id];
  });
}

function checkAll(){
  const s1=stepOk(['rx','ry','rz']);
  const s2=stepOk(['mag']);
  const s3=stepOk(['ux','uy','uz']);
  const s4=stepOk(['fx','fy','fz']);

  // refresh live indicators
  ['rx','ry','rz','mag','ux','uy','uz','fx','fy','fz'].forEach(id=>liveCheck(id));

  const b1=document.getElementById('b1');
  b1.className='check-banner '+(s1?'ok':'err');
  b1.textContent=s1?`âœ“ Correct! r = (${ans.rx}, ${ans.ry}, ${ans.rz})`
    :`âœ— Tip âˆ’ Tail: subtract each tail coordinate from the corresponding tip coordinate.`;

  const b2=document.getElementById('b2');
  b2.className='check-banner '+(s2?'ok':'err');
  b2.textContent=s2?`âœ“ Correct! |r| = ${ans.mag.toFixed(3)} units`
    :`âœ— Try: âˆš(${ans.rx}Â² + ${ans.ry}Â² + ${ans.rz}Â²) = âˆš${ans.rx**2+ans.ry**2+ans.rz**2}`;

  const b3=document.getElementById('b3');
  b3.className='check-banner '+(s3?'ok':'err');
  b3.textContent=s3?`âœ“ Correct! Ã» = (${ans.ux.toFixed(4)}, ${ans.uy.toFixed(4)}, ${ans.uz.toFixed(4)})`
    :`âœ— Divide each position component by |r| = ${ans.mag.toFixed(3)}.`;

  const b4=document.getElementById('b4');
  b4.className='check-banner '+(s4?'ok':'err');
  b4.textContent=s4?`âœ“ Correct! F = (${ans.fx.toFixed(2)}Ã® + ${ans.fy.toFixed(2)}Äµ + ${ans.fz.toFixed(2)}kÌ‚) N`
    :`âœ— Multiply each unit vector component by F = ${forceMag} N.`;

  if(!lastChecked){
    scoreAtt++;
    if(s1&&s2&&s3&&s4){scoreCor++;streak++;}else streak=0;
    lastChecked=true;
    updateScore();
  }
}

function revealAnswer(){
  document.getElementById('rx').value=ans.rx;
  document.getElementById('ry').value=ans.ry;
  document.getElementById('rz').value=ans.rz;
  document.getElementById('mag').value=ans.mag.toFixed(3);
  document.getElementById('ux').value=ans.ux.toFixed(4);
  document.getElementById('uy').value=ans.uy.toFixed(4);
  document.getElementById('uz').value=ans.uz.toFixed(4);
  document.getElementById('fx').value=ans.fx.toFixed(2);
  document.getElementById('fy').value=ans.fy.toFixed(2);
  document.getElementById('fz').value=ans.fz.toFixed(2);
  ['rx','ry','rz','mag','ux','uy','uz','fx','fy','fz'].forEach(id=>liveCheck(id));
  const b4=document.getElementById('b4');
  b4.className='check-banner info';
  b4.textContent='Answer revealed. Study the values, then try a new problem!';
}

function clearInputs(){
  ['rx','ry','rz','mag','ux','uy','uz','fx','fy','fz'].forEach(id=>{
    const el=document.getElementById(id);
    el.value=''; el.className='';
    const h=document.getElementById('h'+id);
    if(h){h.textContent='';h.className='inp-hint';}
  });
  ['b1','b2','b3','b4'].forEach(id=>{
    const el=document.getElementById(id);
    el.className='check-banner'; el.textContent='';
  });
}

function setMode(m){
  mode=m;
  ['AB','BA'].forEach(mm=>document.getElementById('m'+mm).classList.toggle('active',mm===m));
  computeAnswers(); renderPoints(); clearInputs();
}

function toggleHints(){
  hintsVisible=!hintsVisible;
  document.getElementById('global-hint').classList.toggle('show',hintsVisible);
}

function updateScore(){
  document.getElementById('sc-att').textContent=scoreAtt;
  document.getElementById('sc-cor').textContent=scoreCor;
  document.getElementById('sc-str').textContent=streak>0?streak+'ğŸ”¥':streak;
  document.getElementById('sc-pct').textContent=scoreAtt?Math.round(scoreCor/scoreAtt*100)+'%':'â€”';
  const pct=scoreAtt?scoreCor/scoreAtt*100:0;
  document.getElementById('prog-fill').style.width=pct+'%';
  document.getElementById('prog-label').textContent=`${scoreCor} / ${scoreAtt}`;
}

// â”€â”€ 3D Canvas â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const cv=document.getElementById('canvas3d');
const ctx=cv.getContext('2d');

function resize(){
  const r=cv.getBoundingClientRect();
  cv.width=r.width*devicePixelRatio;
  cv.height=r.height*devicePixelRatio;
  ctx.scale(devicePixelRatio,devicePixelRatio);
  drawScene();
}

function project(x,y,z){
  const cy=Math.cos(rotY),sy=Math.sin(rotY);
  const cx=Math.cos(rotX),sx=Math.sin(rotX);
  // z is vertical: remap world(x,y,z) â†’ render(x,z,-y)
  const wx=x,wy=z,wz=-y;
  const x1=wx*cy+wz*sy, z1=-wx*sy+wz*cy;
  const y1=wy*cx-z1*sx;
  const sc=22, W=cv.width/devicePixelRatio, H=cv.height/devicePixelRatio;
  return {sx:W/2+x1*sc, sy:H/2-y1*sc};
}

function drawArrow(x1,y1,z1,x2,y2,z2,color,label,dashed){
  const p1=project(x1,y1,z1),p2=project(x2,y2,z2);
  ctx.beginPath();
  ctx.setLineDash(dashed?[5,3]:[]);
  ctx.strokeStyle=color; ctx.lineWidth=2;
  ctx.moveTo(p1.sx,p1.sy); ctx.lineTo(p2.sx,p2.sy); ctx.stroke();
  const ang=Math.atan2(p2.sy-p1.sy,p2.sx-p1.sx);
  ctx.setLineDash([]);
  ctx.beginPath(); ctx.fillStyle=color;
  ctx.moveTo(p2.sx,p2.sy);
  ctx.lineTo(p2.sx-10*Math.cos(ang-.35),p2.sy-10*Math.sin(ang-.35));
  ctx.lineTo(p2.sx-10*Math.cos(ang+.35),p2.sy-10*Math.sin(ang+.35));
  ctx.closePath(); ctx.fill();
  if(label){ctx.fillStyle=color;ctx.font='bold 12px Segoe UI';ctx.fillText(label,p2.sx+5,p2.sy-5);}
}

function drawDot(x,y,z,color,label){
  const p=project(x,y,z);
  ctx.beginPath(); ctx.arc(p.sx,p.sy,5,0,Math.PI*2);
  ctx.fillStyle=color; ctx.fill();
  if(label){ctx.fillStyle='#222';ctx.font='bold 12px Segoe UI';ctx.fillText(label,p.sx+7,p.sy-5);}
}

function drawScene(){
  const W=cv.width/devicePixelRatio,H=cv.height/devicePixelRatio;
  ctx.clearRect(0,0,W,H);
  // grid
  for(let i=-8;i<=8;i+=2){
    ['#e8edf2'].forEach(c=>{
      const p1=project(i,-8,-8),p2=project(i,8,-8);
      const p3=project(-8,i,-8),p4=project(8,i,-8);
      ctx.beginPath();ctx.setLineDash([]);ctx.strokeStyle=c;ctx.lineWidth=.7;
      ctx.moveTo(p1.sx,p1.sy);ctx.lineTo(p2.sx,p2.sy);ctx.stroke();
      ctx.beginPath();ctx.moveTo(p3.sx,p3.sy);ctx.lineTo(p4.sx,p4.sy);ctx.stroke();
    });
  }
  // axes: green=x, blue=y, orange=z(vertical)
  drawArrow(0,0,0,9,0,0,'#27ae60','x');
  drawArrow(0,0,0,0,9,0,'#2980b9','y');
  drawArrow(0,0,0,0,0,9,'#e67e22','z');
  drawArrow(0,0,0,-4,0,0,'#27ae60','',true);
  drawArrow(0,0,0,0,-4,0,'#2980b9','',true);
  drawArrow(0,0,0,0,0,-4,'#e67e22','',true);
  // projection dashes
  [A,B].forEach(P=>{
    ctx.setLineDash([3,3]);ctx.strokeStyle='#bbb';ctx.lineWidth=1;
    const pxy=project(P.x,P.y,0),pP=project(P.x,P.y,P.z);
    ctx.beginPath();ctx.moveTo(pxy.sx,pxy.sy);ctx.lineTo(pP.sx,pP.sy);ctx.stroke();
    const px=project(P.x,0,0),py=project(0,P.y,0);
    ctx.beginPath();ctx.moveTo(px.sx,px.sy);ctx.lineTo(pxy.sx,pxy.sy);ctx.stroke();
    ctx.beginPath();ctx.moveTo(py.sx,py.sy);ctx.lineTo(pxy.sx,pxy.sy);ctx.stroke();
  });
  // position vector
  const tail=mode==='BA'?B:A, tip=mode==='BA'?A:B;
  drawArrow(tail.x,tail.y,tail.z,tip.x,tip.y,tip.z,'#8e44ad','r');
  // points
  drawDot(A.x,A.y,A.z,'#2980b9',`A(${A.x},${A.y},${A.z})`);
  drawDot(B.x,B.y,B.z,'#e67e22',`B(${B.x},${B.y},${B.z})`);
  drawDot(0,0,0,'#333','O');
}

// drag to rotate
cv.addEventListener('mousedown',e=>{dragging=true;lastMX=e.clientX;lastMY=e.clientY;});
window.addEventListener('mousemove',e=>{
  if(!dragging)return;
  rotY+=(e.clientX-lastMX)*.012; rotX+=(e.clientY-lastMY)*.012;
  lastMX=e.clientX;lastMY=e.clientY; drawScene();
});
window.addEventListener('mouseup',()=>dragging=false);
cv.addEventListener('touchstart',e=>{dragging=true;lastMX=e.touches[0].clientX;lastMY=e.touches[0].clientY;});
cv.addEventListener('touchmove',e=>{
  if(!dragging)return; e.preventDefault();
  rotY+=(e.touches[0].clientX-lastMX)*.012; rotX+=(e.touches[0].clientY-lastMY)*.012;
  lastMX=e.touches[0].clientX;lastMY=e.touches[0].clientY; drawScene();
},{passive:false});
cv.addEventListener('touchend',()=>dragging=false);

window.addEventListener('resize',resize);
resize();
newProblem();
</script>
</body>
</html>
